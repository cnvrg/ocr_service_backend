apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "ocr.fullname" . }}-test-demo"
spec:
  containers:
  - name: "{{ include "ocr.fullname" . }}-test-demo"
    image: {{ .Values.testDemo.image.repository }}/{{ .Values.testDemo.image.name }}:{{ .Values.testDemo.image.tag }}
    imagePullPolicy: {{ .Values.testDemo.image.pullPolicy }}
    command: ["bash", "-c"]
    args:
    - |   
      sleep 30s
      echo "test RESTful API (fastapi)"
      cd /root/ocr_service_backend/client && source local_service/setup_service_env.sh
      python3 test_ocr_rest_client.py
      echo "============================================"
      sleep 1s
      echo "test gRPC connection"
      python3 test_ocr_client.py
      sleep 1h
  imagePullSecrets:
  - name: {{ .Values.imagePullSecret }}
  terminationGracePeriodSeconds: {{ .Values.gracePeriod }}
